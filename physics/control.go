// Code generated by "goal build"; DO NOT EDIT.
//line control.goal:1
// Copyright (c) 2025, Cogent Core. All rights reserved.
// Use of this source code is governed by a BSD-style
// license that can be found in the LICENSE file.

package physics

import "cogentcore.org/core/math32"

//gosl:start

// JointControlVars are external joint control input variables stored in tensor.Float32.
// These must be in one-to-one correspondence with the JointDoFs.
type JointControlVars int32 //enums:enum

const (
	// Joint force and torque inputs
	JointControlForce JointControlVars = iota

	// JointTargetPos is the position target value input to the model,
	// where 0 is the initial position. For angular joints, this is in radians.
	// This is subject to a graded transition over time, [JointTargetPosCur]
	// has the current effective value.
	JointTargetPos

	// JointTargetPosCur is the current position target value,
	// updated from [JointTargetPos] input using the [Params.ControlDt]
	// time constant.
	JointTargetPosCur

	// JointTargetStiff determines how strongly the target position
	// is enforced: 0 = not at all; larger = stronger (e.g., 1000 or higher).
	// Set to 0 to allow the joint to be fully flexible.
	JointTargetStiff

	// JointTargetVel is the velocity target value. For example, 0
	// effectively damps joint movement in proportion to Damp parameter.
	JointTargetVel

	// JointTargetDamp determines how strongly the target velocity is enforced:
	// 0 = not at all; larger = stronger (e.g., 1 is reasonable).
	// Set to 0 to allow the joint to be fully flexible.
	JointTargetDamp
)

// SetJointControl sets the control for given joint, dof and parameter
// to given value.
func SetJointControl(idx, dof int32, vr JointControlVars, value float32) {
	JointControls.Set(value, int(JointDoFIndex(idx, dof)), int(vr))
}

func JointControl(idx, dof int32, vr JointControlVars) float32 {
	return JointControls.Value(int(JointDoFIndex(idx, dof)), int(vr))
}

// SetJointControlForce sets the force for given joint, dof to given value.
func SetJointControlForce(idx, dof int32, value float32) {
	SetJointControl(idx, dof, JointControlForce, value)
}

// SetJointTargetPos sets the target position and stiffness
// for given joint, DoF to given values.
// Stiffness determines how strongly the joint constraint is enforced
// (0 = not at all; 1000+ = strongly).
// For angular joints, values are in radians, see also
// [SetJointTargetAngle].
func SetJointTargetPos(idx, dof int32, pos, stiff float32) {
	SetJointControl(idx, dof, JointTargetPos, pos)
	SetJointControl(idx, dof, JointTargetStiff, stiff)
}

// SetJointTargetAngle sets the target angular position
// and stiffness for given joint, DoF to given values.
// Stiffness determines how strongly the joint constraint is enforced
// (0 = not at all; 1000+ = strongly).
// Angle is in Degrees, not radians. Usable range is within -180..180
// which is enforced, and values near the edge can be unstable at higher
// stiffness levels.
func SetJointTargetAngle(idx, dof int32, angDeg, stiff float32) {
	pos := math32.WrapPi(math32.DegToRad(angDeg))
	SetJointTargetPos(idx, dof, pos, stiff)
}

// GetJointTargetPos returns the target position
// for given joint, DoF.
func GetJointTargetPos(idx, dof int32) float32 {
	return JointControl(idx, dof, JointTargetPos)
}

// SetJointTargetVel sets the target velocity and damping
// for given joint, DoF to given values. Damping determines
// how strongly the joint constraint is enforced
// (0 = not at all; 1000+ = strongly).
func SetJointTargetVel(idx, dof int32, vel, damp float32) {
	SetJointControl(idx, dof, JointTargetVel, vel)
	SetJointControl(idx, dof, JointTargetDamp, damp)
}

// GetJointTargetVel returns the target velocity
// for given joint, DoF.
func GetJointTargetVel(idx, dof int32) float32 {
	return JointControl(idx, dof, JointTargetVel)
}

//gosl:end
